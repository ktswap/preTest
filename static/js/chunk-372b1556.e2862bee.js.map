{"version":3,"sources":["webpack:///./src/views/merge/index.vue?9dec","webpack:///./src/views/merge/index.vue","webpack:///./src/views/merge/index.vue?5d81","webpack:///./src/assets/images/merge.png","webpack:///./src/assets/images/index_img.png","webpack:///./src/assets/images/_4.gif","webpack:///./src/views/merge/index.vue?6fd6"],"names":["class","src","_imports_0","alt","_imports_1","_createElementVNode","_imports_2","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_ctx","loading","Number","_createElementBlock","_component_van_field","$event","type","center","label","placeholder","extra","_hoisted_6","_createBlock","_component_van_button","color","size","loading-text","block","onClick","_component_van_dialog","show","_hoisted_10","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","voiceNftContract","intro","get","config","rootAddress","amount","kttAllowance","btn","initContract","eth","Contract","swapAbi","swapAddress","kttContract","tokenAbi","kttAddress","initData","getKttAllowance","methods","allowance","call","approveKtt","swaploading","approve","MaxUint256","send","from","Toast","mergeNft","balanceOf","balance","minInvestAmount","decimals","kttDecimals","BigNumber","multipliedBy","toFixed","getUserInfo","introUserInfo","userUserInfo","AddressZero","invest","watch","val","refData","toRefs","__exports__","render","module","exports"],"mappings":"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","file":"static/js/chunk-372b1556.e2862bee.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=deba3f88&lang=less&scoped=true\"","<template>\r\n  <div class=\"swap-box invest-box\">\r\n    <HeadTop title=\"合成\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\r\n    <div class=\"img-box\">\r\n      <img v-if=\"!btn.loading || Number(kttAllowance) <=0\" src=\"@/assets/images/merge.png\" alt=\"\">\r\n       <img v-else-if=\"Number(kttAllowance) > 0 && btn.loading\" src=\"@/assets/images/_4.gif\" alt=\"\">\r\n    </div>\r\n    <div class=\"input-box\">\r\n             <van-field class=\"cell-input\"\r\n    v-model=\"amount\"\r\n    type=\"number\"\r\n    center\r\n    label=\"\"\r\n    placeholder=\"请输入投资数量\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">KTT</span>\r\n    </template>\r\n  </van-field>\r\n  </div>\r\n    <div class=\"btn-box\">\r\n      <van-button v-if=\"Number(kttAllowance) > 0\" color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\"  size=\"large\" :loading=\"btn.loading\" loading-text=\"正在合成...\" block @click=\"mergeNft\">合成</van-button>\r\n      <van-button v-else color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\" size=\"large\" :loading=\"btn.loading\" loading-text=\"正在授权...\" block @click=\"approveKtt\">授权</van-button>\r\n    </div>\r\n  </div>\r\n  <van-dialog v-model:show=\"show\" title=\"\">\r\n  <img class=\"show-img\" src=\"@/assets/images/index_img.png\" />\r\n</van-dialog>\r\n</template>\r\n<script>\r\nimport HeadTop from '@/components/HeadTop'\r\nimport { reactive, toRefs, computed, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport swapAbi from \"@/utils/swapAbi\";\r\nimport tokenAbi from \"@/utils/abi.json\";\r\nimport { Toast } from 'vant';\r\nimport config from \"@/utils/config\";\r\nimport { MaxUint256, AddressZero } from \"@ethersproject/constants\";\r\nimport BigNumber from 'bignumber.js';\r\nimport { intro } from '@/storage'\r\nexport default {\r\n  components: {\r\n    HeadTop\r\n  },\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      swapContract: null,\r\n      voiceNftContract: null,\r\n      intro: intro.get() || config.rootAddress,\r\n      show: false,\r\n      amount: '',\r\n      kttAllowance: '',\r\n       btn: {\r\n        loading: false\r\n      },\r\n      initContract: () => {\r\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\r\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getKttAllowance()\r\n      },\r\n       getKttAllowance: async () => {\r\n        let allowance = await data.kttContract.methods.allowance(data.address, config.swapAddress).call()\r\n        data.kttAllowance = allowance;\r\n      },\r\n      approveKtt: async () => {\r\n        data.btn.swaploading = true\r\n        try {\r\n          await data.kttContract.methods.approve(config.swapAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getKttAllowance()\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.swaploading = false\r\n        }\r\n        \r\n      },\r\n      mergeNft: async () => {\r\n        let balance = await data.kttContract.methods.balanceOf(data.address).call()\r\n        let minInvestAmount = await data.swapContract.methods.minInvestAmount().call()\r\n        console.log(minInvestAmount)\r\n        let kttDecimals = await data.kttContract.methods.decimals().call()\r\n        let amount = new BigNumber(data.amount).multipliedBy(10 ** kttDecimals).toFixed()\r\n        if(!data.amount) {\r\n           Toast(`请输入投资数量`)\r\n          return\r\n        }\r\n         if(Number(amount) < Number(minInvestAmount)) {\r\n          Toast(`KTT投资数量最小500KTT`)\r\n          return\r\n        }\r\n        if(Number(balance) < Number(amount)) {\r\n          Toast(`KTT余额不足`)\r\n          return\r\n        }\r\n          let introUserInfo = await data.swapContract.methods.getUserInfo(data.intro).call()\r\n           let userUserInfo = await data.swapContract.methods.getUserInfo(data.address).call()\r\n        if(introUserInfo.intro == AddressZero && data.intro != config.rootAddress && userUserInfo.intro == AddressZero) {\r\n          Toast('推荐人无效')\r\n          return\r\n        }\r\n        data.btn.loading = true\r\n        try {\r\n          await data.swapContract.methods.invest(amount, data.intro).send({from: data.address})\r\n          Toast('合成成功')\r\n          data.show = true\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          console.log(error)\r\n          Toast('合成失败')\r\n          data.btn.loading = false\r\n        }\r\n      }\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.swap-box{\r\n  min-height: calc(100vh - 44px);\r\n  background: url('~@/assets/images/merge_bg.png') no-repeat;\r\n  background-size: cover;\r\n}\r\n.show-img{\r\n  display: block;\r\n  width: 100%;\r\n}\r\n.img-box{\r\n  // padding-top: 30px;\r\n  min-height: 480px;\r\n  img{\r\n    display: block;\r\n    width: 100%;\r\n  }\r\n}\r\n.input-box{\r\n  margin: 0 20px;\r\n}\r\n.btn-box{\r\n  padding: 20px 50px 0;\r\n}\r\n</style>\r\n\r\n<style lang=\"less\">\r\n#app {\r\n  .invest-box{\r\n    .van-cell{\r\n      background: rgba(0, 0, 0, 0.32);\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=deba3f88&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=deba3f88&lang=less&scoped=true\"\nimport \"./index.vue?vue&type=style&index=1&id=deba3f88&lang=less\"\n\nimport exportComponent from \"F:\\\\activeSelf\\\\ketai_vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-deba3f88\"]])\n\nexport default __exports__","module.exports = __webpack_public_path__ + \"static/img/merge.47933a4b.png\";","module.exports = __webpack_public_path__ + \"static/img/index_img.493d4559.png\";","module.exports = __webpack_public_path__ + \"static/img/_4.e8519102.gif\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=1&id=deba3f88&lang=less\""],"sourceRoot":""}